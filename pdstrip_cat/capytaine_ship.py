#!/usr/bin/env python3
"""
Capytaine BEM script generated from pdstrip input files.

Source: Vessel Model generated input file
Generated by pdstrip2capytaine.py

Geometry: 13 sections, sym=False, draft=6.000 m
Catamaran: False, hulld=0.000 m
Frequencies: 35 values (0.3000 to 1.8000 rad/s)
Wave directions: 19 values (-90.0 to 90.0 deg)

Usage:
    python capytaine_ship.py
"""

import numpy as np
import capytaine as cpt
import logging
import xarray as xr

cpt.set_logging(logging.WARNING)

# ============================================================
# Physical constants
# ============================================================
g = 9.81
rho = 1025.0
water_depth = np.inf

# ============================================================
# Frequencies and wave directions
# ============================================================
omega_values = np.array([
        0.300000, 0.316234, 0.333346, 0.351384, 0.370398, 0.390441, 0.411569, 0.433839,
        0.457316, 0.482062, 0.508147, 0.535644, 0.564628, 0.595182, 0.627389, 0.661337,
        0.697124, 0.734845, 0.774612, 0.816528, 0.860711, 0.907286, 0.956379, 1.008129,
        1.062683, 1.120188, 1.180807, 1.244700, 1.312057, 1.383061, 1.457892, 1.536783,
        1.619949, 1.707585, 1.800004
])

wave_directions = np.array([
        -1.57079633, -1.39626340, -1.22173048, -1.04719755, -0.87266463, -0.69813170, -0.52359878, -0.34906585,
        -0.17453293, 0.00000000, 0.17453293, 0.34906585, 0.52359878, 0.69813170, 0.87266463, 1.04719755,
        1.22173048, 1.39626340, 1.57079633
])
wave_directions_deg = np.array([
        -90.0, -80.0, -70.0, -60.0, -50.0, -40.0, -30.0, -20.0,
        -10.0, 0.0, 10.0, 20.0, 30.0, 40.0, 50.0, 60.0,
        70.0, 80.0, 90.0
])

# ============================================================
# Hull mesh: 13 sections lofted into quad panels
# ============================================================
vertices = np.array([
    [-46.100000, -6.982000, 0.000000],
    [-46.100000, -6.258000, -0.276000],
    [-46.100000, -5.532000, -0.545000],
    [-46.100000, -4.805000, -0.814000],
    [-46.100000, -4.073000, -1.066000],
    [-46.100000, -3.341000, -1.318000],
    [-46.100000, -2.606000, -1.563000],
    [-46.100000, -1.866000, -1.793000],
    [-46.100000, -1.127000, -2.024000],
    [-46.100000, -0.376000, -2.214000],
    [-46.100000, 0.376000, -2.214000],
    [-46.100000, 1.127000, -2.024000],
    [-46.100000, 1.866000, -1.793000],
    [-46.100000, 2.606000, -1.563000],
    [-46.100000, 3.341000, -1.318000],
    [-46.100000, 4.073000, -1.066000],
    [-46.100000, 4.805000, -0.814000],
    [-46.100000, 5.532000, -0.545000],
    [-46.100000, 6.258000, -0.276000],
    [-46.100000, 6.982000, 0.000000],
    [-41.300000, -8.482000, -0.000000],
    [-41.300000, -7.626000, -0.399000],
    [-41.300000, -6.764000, -0.783000],
    [-41.300000, -5.899000, -1.162000],
    [-41.300000, -5.006000, -1.467000],
    [-41.300000, -4.106000, -1.752000],
    [-41.300000, -3.212000, -2.054000],
    [-41.300000, -2.303000, -2.310000],
    [-41.300000, -1.387000, -2.537000],
    [-41.300000, -0.462000, -2.728000],
    [-41.300000, 0.462000, -2.728000],
    [-41.300000, 1.387000, -2.537000],
    [-41.300000, 2.303000, -2.310000],
    [-41.300000, 3.212000, -2.054000],
    [-41.300000, 4.106000, -1.752000],
    [-41.300000, 5.006000, -1.467000],
    [-41.300000, 5.899000, -1.162000],
    [-41.300000, 6.764000, -0.783000],
    [-41.300000, 7.626000, -0.399000],
    [-41.300000, 8.482000, -0.000000],
    [-34.700000, -9.836000, 0.000000],
    [-34.700000, -9.100000, -1.089000],
    [-34.700000, -8.043000, -1.901000],
    [-34.700000, -6.890000, -2.562000],
    [-34.700000, -5.660000, -3.077000],
    [-34.700000, -4.404000, -3.523000],
    [-34.700000, -3.132000, -3.925000],
    [-34.700000, -1.847000, -4.283000],
    [-34.700000, -1.235000, -5.183000],
    [-34.700000, -0.667000, -6.002000],
    [-34.700000, 0.667000, -6.002000],
    [-34.700000, 1.235000, -5.183000],
    [-34.700000, 1.847000, -4.283000],
    [-34.700000, 3.132000, -3.925000],
    [-34.700000, 4.404000, -3.523000],
    [-34.700000, 5.660000, -3.077000],
    [-34.700000, 6.890000, -2.562000],
    [-34.700000, 8.043000, -1.901000],
    [-34.700000, 9.100000, -1.089000],
    [-34.700000, 9.836000, 0.000000],
    [-29.300000, -10.014000, 0.000000],
    [-29.300000, -9.687000, -1.303000],
    [-29.300000, -8.938000, -2.425000],
    [-29.300000, -7.856000, -3.231000],
    [-29.300000, -6.633000, -3.815000],
    [-29.300000, -5.374000, -4.316000],
    [-29.300000, -4.089000, -4.748000],
    [-29.300000, -2.786000, -5.121000],
    [-29.300000, -1.458000, -5.391000],
    [-29.300000, -0.678000, -5.981000],
    [-29.300000, 0.678000, -5.981000],
    [-29.300000, 1.458000, -5.391000],
    [-29.300000, 2.786000, -5.121000],
    [-29.300000, 4.089000, -4.748000],
    [-29.300000, 5.374000, -4.316000],
    [-29.300000, 6.633000, -3.815000],
    [-29.300000, 7.856000, -3.231000],
    [-29.300000, 8.938000, -2.425000],
    [-29.300000, 9.687000, -1.303000],
    [-29.300000, 10.014000, 0.000000],
    [-18.500000, -10.042000, 0.000000],
    [-18.500000, -10.045000, -1.491000],
    [-18.500000, -9.944000, -2.970000],
    [-18.500000, -9.226000, -4.258000],
    [-18.500000, -8.041000, -5.154000],
    [-18.500000, -6.682000, -5.753000],
    [-18.500000, -5.220000, -5.984000],
    [-18.500000, -3.728000, -5.988000],
    [-18.500000, -2.237000, -5.992000],
    [-18.500000, -0.746000, -5.996000],
    [-18.500000, 0.746000, -5.996000],
    [-18.500000, 2.237000, -5.992000],
    [-18.500000, 3.728000, -5.988000],
    [-18.500000, 5.220000, -5.984000],
    [-18.500000, 6.682000, -5.753000],
    [-18.500000, 8.041000, -5.154000],
    [-18.500000, 9.226000, -4.258000],
    [-18.500000, 9.944000, -2.970000],
    [-18.500000, 10.045000, -1.491000],
    [-18.500000, 10.042000, 0.000000],
    [-12.500000, -10.025000, -0.000000],
    [-12.500000, -10.022000, -1.624000],
    [-12.500000, -10.020000, -3.247000],
    [-12.500000, -10.001000, -4.868000],
    [-12.500000, -8.925000, -5.958000],
    [-12.500000, -7.306000, -5.985000],
    [-12.500000, -5.682000, -5.988000],
    [-12.500000, -4.059000, -5.991000],
    [-12.500000, -2.435000, -5.993000],
    [-12.500000, -0.812000, -5.996000],
    [-12.500000, 0.812000, -5.996000],
    [-12.500000, 2.435000, -5.993000],
    [-12.500000, 4.059000, -5.991000],
    [-12.500000, 5.682000, -5.988000],
    [-12.500000, 7.306000, -5.985000],
    [-12.500000, 8.925000, -5.958000],
    [-12.500000, 10.001000, -4.868000],
    [-12.500000, 10.020000, -3.247000],
    [-12.500000, 10.022000, -1.624000],
    [-12.500000, 10.025000, -0.000000],
    [0.100000, -10.023000, 0.000000],
    [0.100000, -10.032000, -1.620000],
    [0.100000, -10.041000, -3.241000],
    [0.100000, -9.987000, -4.857000],
    [0.100000, -8.906000, -5.943000],
    [0.100000, -7.292000, -5.992000],
    [0.100000, -5.672000, -5.995000],
    [0.100000, -4.051000, -5.998000],
    [0.100000, -2.431000, -6.000000],
    [0.100000, -0.810000, -6.003000],
    [0.100000, 0.810000, -6.003000],
    [0.100000, 2.431000, -6.000000],
    [0.100000, 4.051000, -5.998000],
    [0.100000, 5.672000, -5.995000],
    [0.100000, 7.292000, -5.992000],
    [0.100000, 8.906000, -5.943000],
    [0.100000, 9.987000, -4.857000],
    [0.100000, 10.041000, -3.241000],
    [0.100000, 10.032000, -1.620000],
    [0.100000, 10.023000, 0.000000],
    [9.700000, -10.024000, 0.000000],
    [9.700000, -10.017000, -1.556000],
    [9.700000, -9.961000, -3.110000],
    [9.700000, -9.545000, -4.594000],
    [9.700000, -8.510000, -5.715000],
    [9.700000, -7.002000, -6.014000],
    [9.700000, -5.446000, -6.011000],
    [9.700000, -3.890000, -6.008000],
    [9.700000, -2.334000, -6.005000],
    [9.700000, -0.778000, -6.001000],
    [9.700000, 0.778000, -6.001000],
    [9.700000, 2.334000, -6.005000],
    [9.700000, 3.890000, -6.008000],
    [9.700000, 5.446000, -6.011000],
    [9.700000, 7.002000, -6.014000],
    [9.700000, 8.510000, -5.715000],
    [9.700000, 9.545000, -4.594000],
    [9.700000, 9.961000, -3.110000],
    [9.700000, 10.017000, -1.556000],
    [9.700000, 10.024000, 0.000000],
    [16.900000, -9.784000, 0.000000],
    [16.900000, -9.549000, -1.394000],
    [16.900000, -9.100000, -2.735000],
    [16.900000, -8.398000, -3.959000],
    [16.900000, -7.529000, -5.070000],
    [16.900000, -6.349000, -5.841000],
    [16.900000, -4.961000, -6.021000],
    [16.900000, -3.544000, -6.015000],
    [16.900000, -2.126000, -6.009000],
    [16.900000, -0.709000, -6.003000],
    [16.900000, 0.709000, -6.003000],
    [16.900000, 2.126000, -6.009000],
    [16.900000, 3.544000, -6.015000],
    [16.900000, 4.961000, -6.021000],
    [16.900000, 6.349000, -5.841000],
    [16.900000, 7.529000, -5.070000],
    [16.900000, 8.398000, -3.959000],
    [16.900000, 9.100000, -2.735000],
    [16.900000, 9.549000, -1.394000],
    [16.900000, 9.784000, -0.000000],
    [28.900000, -7.882000, 0.000000],
    [28.900000, -7.287000, -0.964000],
    [28.900000, -6.683000, -1.922000],
    [28.900000, -6.027000, -2.845000],
    [28.900000, -5.349000, -3.751000],
    [28.900000, -4.577000, -4.580000],
    [28.900000, -3.788000, -5.392000],
    [28.900000, -2.823000, -5.951000],
    [28.900000, -1.699000, -6.000000],
    [28.900000, -0.566000, -6.000000],
    [28.900000, 0.566000, -6.000000],
    [28.900000, 1.699000, -6.000000],
    [28.900000, 2.823000, -5.951000],
    [28.900000, 3.788000, -5.392000],
    [28.900000, 4.577000, -4.580000],
    [28.900000, 5.349000, -3.751000],
    [28.900000, 6.027000, -2.845000],
    [28.900000, 6.683000, -1.922000],
    [28.900000, 7.287000, -0.964000],
    [28.900000, 7.882000, 0.000000],
    [39.700000, -2.274000, 0.000000],
    [39.700000, -2.192000, -0.718000],
    [39.700000, -2.111000, -1.436000],
    [39.700000, -2.004000, -2.150000],
    [39.700000, -1.870000, -2.859000],
    [39.700000, -1.736000, -3.569000],
    [39.700000, -1.477000, -4.243000],
    [39.700000, -1.212000, -4.915000],
    [39.700000, -0.850000, -5.533000],
    [39.700000, -0.361000, -6.000000],
    [39.700000, 0.361000, -6.000000],
    [39.700000, 0.850000, -5.533000],
    [39.700000, 1.212000, -4.915000],
    [39.700000, 1.477000, -4.243000],
    [39.700000, 1.736000, -3.569000],
    [39.700000, 1.870000, -2.859000],
    [39.700000, 2.004000, -2.150000],
    [39.700000, 2.111000, -1.436000],
    [39.700000, 2.192000, -0.718000],
    [39.700000, 2.274000, -0.000000],
    [42.700000, 0.000000, -0.200000],
    [42.700000, -0.548000, -0.474000],
    [42.700000, -1.048000, -0.821000],
    [42.700000, -1.333000, -1.333000],
    [42.700000, -1.406000, -1.924000],
    [42.700000, -1.200000, -2.502000],
    [42.700000, -0.995000, -3.080000],
    [42.700000, -0.785000, -3.656000],
    [42.700000, -0.537000, -4.216000],
    [42.700000, -0.267000, -4.767000],
    [42.700000, 0.267000, -4.767000],
    [42.700000, 0.537000, -4.216000],
    [42.700000, 0.785000, -3.656000],
    [42.700000, 0.995000, -3.080000],
    [42.700000, 1.200000, -2.502000],
    [42.700000, 1.406000, -1.924000],
    [42.700000, 1.333000, -1.333000],
    [42.700000, 1.048000, -0.821000],
    [42.700000, 0.548000, -0.474000],
    [42.700000, 0.000000, -0.200000],
    [45.800000, 0.000000, -1.800000],
    [45.800000, -0.042105, -1.800000],
    [45.800000, -0.084211, -1.800000],
    [45.800000, -0.100000, -1.826316],
    [45.800000, -0.100000, -1.868421],
    [45.800000, -0.100000, -1.910526],
    [45.800000, -0.100000, -1.952632],
    [45.800000, -0.100000, -1.994737],
    [45.800000, -0.063158, -2.000000],
    [45.800000, -0.021053, -2.000000],
    [45.800000, 0.021053, -2.000000],
    [45.800000, 0.063158, -2.000000],
    [45.800000, 0.100000, -1.994737],
    [45.800000, 0.100000, -1.952632],
    [45.800000, 0.100000, -1.910526],
    [45.800000, 0.100000, -1.868421],
    [45.800000, 0.100000, -1.826316],
    [45.800000, 0.084211, -1.800000],
    [45.800000, 0.042105, -1.800000],
    [45.800000, 0.000000, -1.800000],
])

faces = np.array([
    [0, 1, 21, 20],
    [1, 2, 22, 21],
    [2, 3, 23, 22],
    [3, 4, 24, 23],
    [4, 5, 25, 24],
    [5, 6, 26, 25],
    [6, 7, 27, 26],
    [7, 8, 28, 27],
    [8, 9, 29, 28],
    [9, 10, 30, 29],
    [10, 11, 31, 30],
    [11, 12, 32, 31],
    [12, 13, 33, 32],
    [13, 14, 34, 33],
    [14, 15, 35, 34],
    [15, 16, 36, 35],
    [16, 17, 37, 36],
    [17, 18, 38, 37],
    [18, 19, 39, 38],
    [20, 21, 41, 40],
    [21, 22, 42, 41],
    [22, 23, 43, 42],
    [23, 24, 44, 43],
    [24, 25, 45, 44],
    [25, 26, 46, 45],
    [26, 27, 47, 46],
    [27, 28, 48, 47],
    [28, 29, 49, 48],
    [29, 30, 50, 49],
    [30, 31, 51, 50],
    [31, 32, 52, 51],
    [32, 33, 53, 52],
    [33, 34, 54, 53],
    [34, 35, 55, 54],
    [35, 36, 56, 55],
    [36, 37, 57, 56],
    [37, 38, 58, 57],
    [38, 39, 59, 58],
    [40, 41, 61, 60],
    [41, 42, 62, 61],
    [42, 43, 63, 62],
    [43, 44, 64, 63],
    [44, 45, 65, 64],
    [45, 46, 66, 65],
    [46, 47, 67, 66],
    [47, 48, 68, 67],
    [48, 49, 69, 68],
    [49, 50, 70, 69],
    [50, 51, 71, 70],
    [51, 52, 72, 71],
    [52, 53, 73, 72],
    [53, 54, 74, 73],
    [54, 55, 75, 74],
    [55, 56, 76, 75],
    [56, 57, 77, 76],
    [57, 58, 78, 77],
    [58, 59, 79, 78],
    [60, 61, 81, 80],
    [61, 62, 82, 81],
    [62, 63, 83, 82],
    [63, 64, 84, 83],
    [64, 65, 85, 84],
    [65, 66, 86, 85],
    [66, 67, 87, 86],
    [67, 68, 88, 87],
    [68, 69, 89, 88],
    [69, 70, 90, 89],
    [70, 71, 91, 90],
    [71, 72, 92, 91],
    [72, 73, 93, 92],
    [73, 74, 94, 93],
    [74, 75, 95, 94],
    [75, 76, 96, 95],
    [76, 77, 97, 96],
    [77, 78, 98, 97],
    [78, 79, 99, 98],
    [80, 81, 101, 100],
    [81, 82, 102, 101],
    [82, 83, 103, 102],
    [83, 84, 104, 103],
    [84, 85, 105, 104],
    [85, 86, 106, 105],
    [86, 87, 107, 106],
    [87, 88, 108, 107],
    [88, 89, 109, 108],
    [89, 90, 110, 109],
    [90, 91, 111, 110],
    [91, 92, 112, 111],
    [92, 93, 113, 112],
    [93, 94, 114, 113],
    [94, 95, 115, 114],
    [95, 96, 116, 115],
    [96, 97, 117, 116],
    [97, 98, 118, 117],
    [98, 99, 119, 118],
    [100, 101, 121, 120],
    [101, 102, 122, 121],
    [102, 103, 123, 122],
    [103, 104, 124, 123],
    [104, 105, 125, 124],
    [105, 106, 126, 125],
    [106, 107, 127, 126],
    [107, 108, 128, 127],
    [108, 109, 129, 128],
    [109, 110, 130, 129],
    [110, 111, 131, 130],
    [111, 112, 132, 131],
    [112, 113, 133, 132],
    [113, 114, 134, 133],
    [114, 115, 135, 134],
    [115, 116, 136, 135],
    [116, 117, 137, 136],
    [117, 118, 138, 137],
    [118, 119, 139, 138],
    [120, 121, 141, 140],
    [121, 122, 142, 141],
    [122, 123, 143, 142],
    [123, 124, 144, 143],
    [124, 125, 145, 144],
    [125, 126, 146, 145],
    [126, 127, 147, 146],
    [127, 128, 148, 147],
    [128, 129, 149, 148],
    [129, 130, 150, 149],
    [130, 131, 151, 150],
    [131, 132, 152, 151],
    [132, 133, 153, 152],
    [133, 134, 154, 153],
    [134, 135, 155, 154],
    [135, 136, 156, 155],
    [136, 137, 157, 156],
    [137, 138, 158, 157],
    [138, 139, 159, 158],
    [140, 141, 161, 160],
    [141, 142, 162, 161],
    [142, 143, 163, 162],
    [143, 144, 164, 163],
    [144, 145, 165, 164],
    [145, 146, 166, 165],
    [146, 147, 167, 166],
    [147, 148, 168, 167],
    [148, 149, 169, 168],
    [149, 150, 170, 169],
    [150, 151, 171, 170],
    [151, 152, 172, 171],
    [152, 153, 173, 172],
    [153, 154, 174, 173],
    [154, 155, 175, 174],
    [155, 156, 176, 175],
    [156, 157, 177, 176],
    [157, 158, 178, 177],
    [158, 159, 179, 178],
    [160, 161, 181, 180],
    [161, 162, 182, 181],
    [162, 163, 183, 182],
    [163, 164, 184, 183],
    [164, 165, 185, 184],
    [165, 166, 186, 185],
    [166, 167, 187, 186],
    [167, 168, 188, 187],
    [168, 169, 189, 188],
    [169, 170, 190, 189],
    [170, 171, 191, 190],
    [171, 172, 192, 191],
    [172, 173, 193, 192],
    [173, 174, 194, 193],
    [174, 175, 195, 194],
    [175, 176, 196, 195],
    [176, 177, 197, 196],
    [177, 178, 198, 197],
    [178, 179, 199, 198],
    [180, 181, 201, 200],
    [181, 182, 202, 201],
    [182, 183, 203, 202],
    [183, 184, 204, 203],
    [184, 185, 205, 204],
    [185, 186, 206, 205],
    [186, 187, 207, 206],
    [187, 188, 208, 207],
    [188, 189, 209, 208],
    [189, 190, 210, 209],
    [190, 191, 211, 210],
    [191, 192, 212, 211],
    [192, 193, 213, 212],
    [193, 194, 214, 213],
    [194, 195, 215, 214],
    [195, 196, 216, 215],
    [196, 197, 217, 216],
    [197, 198, 218, 217],
    [198, 199, 219, 218],
    [200, 201, 221, 220],
    [201, 202, 222, 221],
    [202, 203, 223, 222],
    [203, 204, 224, 223],
    [204, 205, 225, 224],
    [205, 206, 226, 225],
    [206, 207, 227, 226],
    [207, 208, 228, 227],
    [208, 209, 229, 228],
    [209, 210, 230, 229],
    [210, 211, 231, 230],
    [211, 212, 232, 231],
    [212, 213, 233, 232],
    [213, 214, 234, 233],
    [214, 215, 235, 234],
    [215, 216, 236, 235],
    [216, 217, 237, 236],
    [217, 218, 238, 237],
    [218, 219, 239, 238],
    [220, 221, 241, 240],
    [221, 222, 242, 241],
    [222, 223, 243, 242],
    [223, 224, 244, 243],
    [224, 225, 245, 244],
    [225, 226, 246, 245],
    [226, 227, 247, 246],
    [227, 228, 248, 247],
    [228, 229, 249, 248],
    [229, 230, 250, 249],
    [230, 231, 251, 250],
    [231, 232, 252, 251],
    [232, 233, 253, 252],
    [233, 234, 254, 253],
    [234, 235, 255, 254],
    [235, 236, 256, 255],
    [236, 237, 257, 256],
    [237, 238, 258, 257],
    [238, 239, 259, 258],
])

print(f"Hull mesh: {vertices.shape[0]} vertices, {faces.shape[0]} quad faces")


# ============================================================
# Monohull body setup
# ============================================================
hull_mesh = cpt.Mesh(vertices=vertices, faces=faces, name='hull')

# Clip to below waterline
hull_mesh = hull_mesh.immersed_part(water_depth=np.inf)
print(f"Immersed mesh: {hull_mesh.nb_faces} faces")

# Add lid to suppress irregular frequencies
lid = hull_mesh.generate_lid(z=-0.0100)

body = cpt.FloatingBody(mesh=hull_mesh, lid_mesh=lid, name='vessel')
body.add_all_rigid_body_dofs()
print(f"Body DOFs: {list(body.dofs.keys())}")

# ============================================================
# Set up and solve BEM problems
# ============================================================
problems = []
for omega in omega_values:
    for dof in body.dofs:
        problems.append(cpt.RadiationProblem(
            body=body, radiating_dof=dof, omega=omega,
            water_depth=water_depth, rho=rho, g=g))
    for beta in wave_directions:
        problems.append(cpt.DiffractionProblem(
            body=body, wave_direction=beta, omega=omega,
            water_depth=water_depth, rho=rho, g=g))

print(f"Solving {len(problems)} BEM problems...")
solver = cpt.BEMSolver()
results = solver.solve_all(problems, progress_bar=True)

# Assemble into xarray dataset
dataset = cpt.assemble_dataset(results)

# ============================================================
# Save results
# ============================================================
# Save as numpy archive (avoids xarray/netCDF dtype issues with complex data)
output_file = 'capytaine_ship_results.npz'
np.savez(output_file,
    omega=omega_values,
    wave_directions=wave_directions,
    wave_directions_deg=wave_directions_deg,
    added_mass=dataset['added_mass'].values,
    radiation_damping=dataset['radiation_damping'].values,
    diffraction_force=dataset['diffraction_force'].values if 'diffraction_force' in dataset else np.array([]),
    Froude_Krylov_force=dataset['Froude_Krylov_force'].values if 'Froude_Krylov_force' in dataset else np.array([]),
    radiating_dofs=np.array(list(dataset.coords['radiating_dof'].values)),
    influenced_dofs=np.array(list(dataset.coords['influenced_dof'].values)),
    g=g, rho=rho, water_depth=np.inf,
)
print(f"Results saved to {output_file}")

# ============================================================
# Print summary table
# ============================================================
print("\n" + "="*70)
print("RESULTS SUMMARY")
print("="*70)
dofs = list(body.dofs.keys())
for dof in ['Surge', 'Sway', 'Heave', 'Roll', 'Pitch', 'Yaw'] + [d for d in dofs if '__' in d]:
    if dof not in dofs and not any(dof in d for d in dofs):
        continue
    # Find matching DOF name
    matches = [d for d in dofs if d == dof or d.endswith(dof)]
    for dof_name in matches[:1]:
        try:
            am = dataset['added_mass'].sel(radiating_dof=dof_name, influenced_dof=dof_name)
            rd = dataset['radiation_damping'].sel(radiating_dof=dof_name, influenced_dof=dof_name)
            print(f"\n{dof_name}:")
            print(f"  omega     added_mass      damping")
            for iw, w in enumerate(omega_values[:10]):
                a_val = float(am.sel(omega=w, method='nearest'))
                b_val = float(rd.sel(omega=w, method='nearest'))
                print(f"  {w:8.4f}  {a_val:14.4f}  {b_val:14.4f}")
            if len(omega_values) > 10:
                print(f"  ... ({len(omega_values) - 10} more frequencies)")
        except (KeyError, ValueError):
            pass

print("\nDone.")
